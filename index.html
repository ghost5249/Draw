<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½‰ç›¤æŠ½çæ©Ÿ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f3f6;
            margin: 0;
            color: #333;
        }
        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 90%;
            max-width: 800px;
        }
        h1 {
            color: #007bff;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .content-wrapper {
            display: flex;
            flex-wrap: wrap; 
            gap: 30px;
            justify-content: center;
            align-items: flex-start;
        }
        .controls {
            flex: 1;
            min-width: 300px;
        }
        
        textarea {
            width: 100%;
            height: 250px;
            padding: 15px;
            margin-bottom: 10px; 
            border: 2px solid #ccc;
            border-radius: 8px;
            resize: vertical;
            font-size: 16px;
            box-sizing: border-box; 
        }
        
        .button-group {
            display: flex;
            gap: 10px; 
            margin-bottom: 15px;
        }
        
        .button-group button {
            flex: 1; 
            padding: 12px 15px;
            font-size: 16px;
        }

        #spin-button {
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }
        #spin-button:hover:not(:disabled) {
            background-color: #218838;
        }

        #clear-button {
            background-color: #dc3545; 
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }
        #clear-button:hover:not(:disabled) {
            background-color: #c82333;
        }

        button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }
        
        .wheel-area {
            flex-shrink: 0; 
            width: 320px; 
            height: 350px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        #wheel-container {
            position: absolute;
            top: 20px;
            width: 320px; 
            height: 320px;
            overflow: hidden;
            border-radius: 50%;
        }

        #wheel {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 10px solid #f8d7da;
            background: transparent; 
            position: absolute;
            top: 0;
            left: 10px; 
            transition: transform 6s cubic-bezier(0.25, 0.1, 0.25, 1);
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
        .wheel-segment { display: none; } 

        #text-layer {
            position: absolute;
            top: 0;
            left: 10px;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            z-index: 5; 
            pointer-events: none; 
            transition: transform 6s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        .segment-text {
            position: absolute;
            width: 100px; 
            height: 18px; 
            font-size: 14px;
            font-weight: bold;
            color: black; 
            text-shadow: none; 
            text-align: center;
            transform-origin: 50% 50%;
        }

        #pointer {
            position: absolute;
            top: 0px; 
            left: 50%;
            transform: translate(-50%, 0%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 20px solid #dc3545;
            z-index: 10;
        }
        
        #result-display {
            margin-top: 20px;
            padding: 15px;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            border-radius: 8px;
            min-height: 40px;
            font-size: 1.2em;
            font-weight: bold;
            width: 100%;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¡ è½‰ç›¤æŠ½çæ©Ÿ</h1>
        <div class="content-wrapper">
            <div class="controls">
                <p>è«‹åœ¨ä¸‹æ–¹è¼¸å…¥åƒèˆ‡æŠ½ççš„äººå“¡æˆ–é …ç›®æ¸…å–®ï¼Œæ¯è¡Œä¸€å€‹ã€‚</p>
                <textarea id="participants-input" placeholder="ä¾‹å¦‚ï¼š
ç‹å°æ˜
é™³å¤§è¯
..."></textarea>
                
                <div class="button-group">
                    <button id="spin-button" onclick="startLottery()">é–‹å§‹æŠ½ç</button>
                    <button id="clear-button" onclick="clearParticipants()">ä¸€éµæ¸…é™¤</button>
                </div>
                
                <div id="result-display">è«‹è¼¸å…¥åƒèˆ‡è€…åå–®ï¼</div>
            </div>
            
            <div class="wheel-area">
                <div id="pointer"></div>
                <div id="wheel-container">
                    <div id="wheel">
                        </div>
                    <div id="text-layer">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const EXCLUDED_NAME = "BEBE"; 
        const ANIMATION_DURATION = '6s'; 
        
        const wheel = document.getElementById('wheel');
        const textLayer = document.getElementById('text-layer');
        const resultDisplay = document.getElementById('result-display');
        const spinButton = document.getElementById('spin-button');
        const participantsInput = document.getElementById('participants-input');
        const wheelRadius = 150; 
        const textDistance = 90; 
        
        const BLUE = '#007bff';
        const WHITE = '#ffffff';
        const colors = [BLUE, WHITE]; 

        // è¼”åŠ©å‡½æ•¸ 1: å–å¾—æ‰€æœ‰è¼¸å…¥åå–® (ç”¨æ–¼ç¹ªè£½è½‰ç›¤)
        function getParticipantsToDraw() {
            return participantsInput.value.split('\n')
                                         .map(name => name.trim())
                                         .filter(name => name.length > 0);
        }

        // è¼”åŠ©å‡½æ•¸ 2: å–å¾—å¯ä¾›æŠ½ççš„åå–® (ç”¨æ–¼å¯¦éš›æŠ½ç)
        function getParticipantsForLottery(allParticipants) {
            return allParticipants.filter(name => name.toLowerCase() !== EXCLUDED_NAME.toLowerCase());
        }

        // ç¹ªè£½è½‰ç›¤çš„å‡½æ•¸ (ä½¿ç”¨å®Œæ•´åå–®å’Œ conic-gradient)
        function drawWheel(participants) {
            wheel.innerHTML = ''; 
            textLayer.innerHTML = ''; 
            const numSegments = participants.length;
            
            if (numSegments === 0) {
                 wheel.style.backgroundColor = '#e9ecef';
                 wheel.style.border = '10px dashed #ccc'; 
                 wheel.style.background = 'none'; 
                 return;
            }
            wheel.style.border = '10px solid #f8d7da';
            wheel.style.backgroundColor = 'transparent'; 
            
            const degreesPerSegment = 360 / numSegments;
            let gradientString = 'conic-gradient(';
            let startAngle = 0;
            
            participants.forEach((name, index) => {
                const segmentColor = colors[index % colors.length];
                const endAngle = startAngle + degreesPerSegment;
                
                // 1. é¡è‰²éƒ¨åˆ†
                gradientString += `${segmentColor} ${startAngle}deg ${endAngle}deg, `;
                
                // 2. ç¹ªè£½å§“åæ–‡å­— (å¼·åˆ¶ä½¿ç”¨é»‘è‰²)
                const rotation = index * degreesPerSegment;
                const textElement = document.createElement('div');
                textElement.className = 'segment-text';
                textElement.textContent = name;
                textElement.style.color = 'black'; 
                
                // è¨ˆç®—æ–‡å­—çš„ä¸­å¿ƒè§’åº¦å’Œä½ç½®
                const centerAngle = (rotation + degreesPerSegment / 2) * (Math.PI / 180);
                const x = wheelRadius + textDistance * Math.sin(centerAngle);
                const y = wheelRadius - textDistance * Math.cos(centerAngle);

                textElement.style.left = `${x - 50}px`; 
                textElement.style.top = `${y - 9}px`;  
                
                const textRotation = rotation + degreesPerSegment / 2;
                textElement.style.transform = `rotate(${textRotation}deg)`;
                
                textLayer.appendChild(textElement);
                
                startAngle = endAngle; 
            });
            
            // æ‡‰ç”¨ conic-gradient
            gradientString = gradientString.slice(0, -2) + ')'; 
            wheel.style.background = gradientString;
        }

        // ä¸€éµæ¸…é™¤å‡½æ•¸
        function clearParticipants() {
            participantsInput.value = ''; 
            drawWheel([]); 
            spinButton.disabled = true; 
            resultDisplay.textContent = 'è«‹è¼¸å…¥åƒèˆ‡è€…åå–®ï¼';
            
            // é—œéµä¿®æ­£ 1: é‡ç½®è½‰ç›¤å’Œæ–‡å­—çš„è§’åº¦
            wheel.style.transform = 'rotate(0deg)';
            textLayer.style.transform = 'rotate(0deg)';
            
            // é‡ç½®å‹•ç•«ï¼Œç¢ºä¿ä¸‹æ¬¡æ—‹è½‰ä¸æœƒå› ç‚º transform çš„å€¼è€Œå½±éŸ¿é€Ÿåº¦
            wheel.style.transition = 'none';
            textLayer.style.transition = 'none';
        }


        // ç›£è½è¼¸å…¥æ¡†è®ŠåŒ–ï¼Œå³æ™‚æ›´æ–°è½‰ç›¤
        participantsInput.addEventListener('input', function() {
            const participantsToDraw = getParticipantsToDraw();
            const participantsForLottery = getParticipantsForLottery(participantsToDraw);
            
            // ç•¶è¼¸å…¥åå–®ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œå°‡è½‰ç›¤è§’åº¦æ­¸é›¶ï¼Œè¦–è¦ºä¸Šæ›´æ¸…æ™°
            wheel.style.transform = 'rotate(0deg)';
            textLayer.style.transform = 'rotate(0deg)';
            
            drawWheel(participantsToDraw);

            if (participantsForLottery.length === 0) {
                resultDisplay.textContent = 'æ²’æœ‰å¯ä¾›æŠ½ççš„åƒèˆ‡è€…ï¼';
                spinButton.disabled = true;
            } else {
                resultDisplay.textContent = 'é»æ“Šã€Œé–‹å§‹æŠ½çã€ï¼';
                spinButton.disabled = false;
            }
        });

        // æŠ½çä¸»å‡½æ•¸
        function startLottery() {
            spinButton.disabled = true; 
            resultDisplay.textContent = 'è½‰ç›¤æ—‹è½‰ä¸­...';

            const participantsToDraw = getParticipantsToDraw();
            const participantsForLottery = getParticipantsForLottery(participantsToDraw);

            if (participantsForLottery.length === 0) {
                resultDisplay.textContent = 'æ²’æœ‰å¯ä¾›æŠ½ççš„åƒèˆ‡è€…ï¼';
                spinButton.disabled = false;
                return;
            }
            
            // é—œéµä¿®æ­£ 2: åœ¨è¨­å®šæ–°çš„æ—‹è½‰å‰ï¼Œå…ˆå¼·åˆ¶é‡è¨­å‹•ç•«å’Œè§’åº¦ï¼Œç¢ºä¿å¾ 0 åº¦é–‹å§‹
            wheel.style.transition = 'none';
            textLayer.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';
            textLayer.style.transform = 'rotate(0deg)';

            // è§¸ç™¼é‡ç¹ª (å¿…é ˆæœ‰é€™ä¸€æ­¥ï¼Œç€è¦½å™¨æ‰èƒ½å€åˆ† 'none' å’Œæ–°çš„ transition)
            // è®€å– offsetHeight æ˜¯è§¸ç™¼ç€è¦½å™¨é‡ç¹ªçš„å¸¸è¦‹æŠ€å·§
            wheel.offsetHeight; 

            drawWheel(participantsToDraw); 

            const winningLotteryIndex = Math.floor(Math.random() * participantsForLottery.length);
            const winner = participantsForLottery[winningLotteryIndex];
            
            const winningDrawIndex = participantsToDraw.indexOf(winner);
            
            const numSegments = participantsToDraw.length;
            const degreesPerSegment = 360 / numSegments;
            
            let rotationToAlign = 360 - ((winningDrawIndex * degreesPerSegment) + (degreesPerSegment / 2));
            const extraSpins = 5 * 360; 
            let finalRotation = -(extraSpins + rotationToAlign + (Math.random() * (degreesPerSegment - 5) + 2.5));

            // é‡æ–°è¨­å®šå›ºå®šçš„ transition æ™‚é–“
            wheel.style.transition = `transform ${ANIMATION_DURATION} cubic-bezier(0.25, 0.1, 0.25, 1)`;
            textLayer.style.transition = `transform ${ANIMATION_DURATION} cubic-bezier(0.25, 0.1, 0.25, 1)`;
            
            // åŸ·è¡Œæ—‹è½‰
            wheel.style.transform = `rotate(${finalRotation}deg)`;
            textLayer.style.transform = `rotate(${finalRotation}deg)`;

            // é¡¯ç¤ºçµæœ
            setTimeout(() => {
                resultDisplay.textContent = `ğŸ‰ æ­å–œï¼å¹¸é‹å…’æ˜¯ï¼š${winner}ï¼`;
                spinButton.disabled = false;
            }, 6500); 
        }
        
        // åˆå§‹è¼‰å…¥æ™‚
        document.addEventListener('DOMContentLoaded', function() {
            clearParticipants(); // ä½¿ç”¨æ–°çš„ clear å‡½æ•¸åˆå§‹åŒ–
        });

    </script>
</body>
</html>
